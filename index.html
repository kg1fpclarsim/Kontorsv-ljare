<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sök kontor</title>
<style>
:root { --bg:#f9f9f9; --fg:#111; --muted:#6b7280; --brand:#1e90ff; --brand-dark:#1874cc; }
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif; background:var(--bg); color:var(--fg); margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; }
.card { width:min(92vw, 560px); background:#fff; border-radius:16px; box-shadow:0 6px 18px rgba(0,0,0,.08); padding:20px; }
h1 { font-size:20px; margin:4px 0 16px; text-align:center; }
.row { display:flex; gap:10px; }
@media (max-width: 480px){ .row { flex-direction:column; } }
input[type="text"] { flex:1; padding:14px 12px; font-size:16px; border:1px solid #e5e7eb; border-radius:12px; outline:none; }
input[type="text"]:focus { border-color:var(--brand); box-shadow:0 0 0 3px rgba(30,144,255,.15); }
button { padding:14px 18px; font-size:16px; border:0; border-radius:12px; background:var(--brand); color:#fff; cursor:pointer; }
button:active { background:var(--brand-dark); }
#result { margin-top:16px; font-size:18px; font-weight:600; text-align:center; word-wrap:break-word; }
#debug { margin-top:10px; font-size:12px; color:var(--muted); text-align:center; }
</style>
</head>
<body>
<div class="card">
<h1>Sök kontor</h1>
<div class="row">
<input id="q" type="text" autocomplete="postal-code" placeholder="Postnummer eller ort" />
<button id="go">Sök</button>
</div>
<div id="result"></div>
<div id="debug"></div>
</div>

  <script>
    const csvUrl = "https://raw.githubusercontent.com/kg1fpclarsim/Kontorsv-ljare/refs/heads/main/Schenker%20kontor.csv"; // <-- ändra till rätt raw-länk
    let table = [];
    let rawHeaders = [];
    let indices = {};

    function detectDelimiter(text){
      if (text.indexOf(';') !== -1) return ';';
      if (text.indexOf(',') !== -1) return ',';
      if (text.indexOf('\t') !== -1) return '\t';
      return ',';
    }

    function splitCSVLine(line, delimiter){
      const out = [];
      let cur = '';
      let inQuotes = false;
      for (let i = 0; i < line.length; i++){
        const ch = line[i];
        if (ch === '"'){
          if (inQuotes && line[i+1] === '"') { cur += '"'; i++; continue; }
          inQuotes = !inQuotes;
          continue;
        }
        if (ch === delimiter && !inQuotes){
          out.push(cur);
          cur = '';
        } else {
          cur += ch;
        }
      }
      out.push(cur);
      return out.map(s => s === undefined ? '' : s);
    }

    function normalizeHeader(h){
      if (!h) return '';
      return h.toString().trim().toLowerCase().replace(/\s+/g,'').replace(/[^a-z0-9åäö]/g,'');
    }

    function findHeaderIndex(headers, candidates){
      for (let i = 0; i < headers.length; i++){
        const nh = normalizeHeader(headers[i]);
        for (const c of candidates){
          if (nh === normalizeHeader(c)) return i;
        }
      }
      return -1;
    }

    function normalizePostnummer(p){ return (p||'').toString().replace(/\s+/g,''); }
    function normalizeText(t){ return (t||'').toString().trim().toLowerCase(); }

    function parseAndIndexCSV(text){
      text = text.replace(/^\uFEFF/, '');
      const delimiter = detectDelimiter(text);
      const lines = text.split(/\r?\n/);
      let headerLineIndex = 0;
      while (headerLineIndex < lines.length && lines[headerLineIndex].trim() === '') headerLineIndex++;
      const headers = splitCSVLine(lines[headerLineIndex], delimiter).map(h => h.trim());
      rawHeaders = headers.slice();

      indices.postnummer = findHeaderIndex(headers, ['Postnummer','Postnr']);
      indices.postort = findHeaderIndex(headers, ['Postort','Ort']);
      indices.kontor = findHeaderIndex(headers, ['Kontor']);

      table = [];
      for (let i = headerLineIndex + 1; i < lines.length; i++){
        if (lines[i].trim() === '') continue;
        const cols = splitCSVLine(lines[i], delimiter);
        const obj = {};
        for (let c = 0; c < headers.length; c++){
          obj[normalizeHeader(headers[c] || ('col'+c))] = (cols[c] || '').trim();
        }
        table.push(obj);
      }
    }

    function searchKontor(input){
      if (!input) return null;
      const postnummerHdr = normalizeHeader(rawHeaders[indices.postnummer]);
      const postortHdr = normalizeHeader(rawHeaders[indices.postort]);
      const kontorHdr = normalizeHeader(rawHeaders[indices.kontor]);

      const pn = normalizePostnummer(input);
      for (let r of table){
        if (normalizePostnummer(r[postnummerHdr]) === pn){
          return r[kontorHdr];
        }
      }

      const ort = normalizeText(input);
      for (let r of table){
        if (normalizeText(r[postortHdr]) === ort){
          return r[kontorHdr];
        }
      }
      return null;
    }

    fetch(csvUrl).then(r => r.text()).then(text => {
      parseAndIndexCSV(text);
      document.getElementById('searchBtn').disabled = false;
    });

    document.getElementById('searchBtn').addEventListener('click', () => {
      const val = document.getElementById('searchBox').value;
      const res = searchKontor(val);
      document.getElementById('result').textContent = res ? res : "Ingen träff";
    });

    document.getElementById('searchBox').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') document.getElementById('searchBtn').click();
    });
  </script>
</body>
</html>
