<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Sök kontor</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 8px; margin: 5px; }
    #result { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Sök kontor via Postnummer eller Postort</h1>

  <!-- Sökruta -->
  <input type="text" id="searchInput" placeholder="Ange postnummer eller ort">
  <button onclick="search()">Sök</button>

  <!-- Resultat -->
  <div id="result">CSV laddas in...</div>

  <script>
    let csvData = [];

    // HÄR: byt till din riktiga raw-länk från GitHub
    const csvUrl = "https://raw.githubusercontent.com/<DITT_GITHUB_ANVÄNDARNAMN>/<DITT_REPO>/main/Schenker%20kontor.csv";

    // Hämta CSV från GitHub
    fetch(csvUrl)
      .then(response => response.text())
      .then(text => parseCSV(text))
      .catch(err => {
        document.getElementById('result').textContent = "Fel vid laddning av CSV: " + err;
      });

    // Parser som klarar både ; och ,
    function parseCSV(text) {
      const delimiter = text.includes(";") ? ";" : ",";
      const rows = text.split(/\r?\n/).map(r => r.split(delimiter));
      const headers = rows[0].map(h => h.trim());
      const postnummerIndex = headers.indexOf("Postnummer");
      const postortIndex = headers.indexOf("Postort");
      const kontorIndex = headers.indexOf("Kontor");

      csvData = rows.slice(1).map(row => ({
        postnummer: row[postnummerIndex] ? row[postnummerIndex].trim() : "",
        postort: row[postortIndex] ? row[postortIndex].trim() : "",
        kontor: row[kontorIndex] ? row[kontorIndex].trim() : ""
      }));

      document.getElementById('result').textContent = "CSV laddad. Ange postnummer eller ort ovan.";
    }

    // Söker i data (tillåter delsträngar och ignorerar mellanslag i postnummer)
    function search() {
      const query = document.getElementById('searchInput').value.trim().toLowerCase().replace(/\s+/g, "");

      if (!query) {
        document.getElementById('result').textContent = "Ange ett postnummer eller ort.";
        return;
      }

      const matches = csvData.filter(row => {
        const pn = row.postnummer.toLowerCase().replace(/\s+/g, "");
        const po = row.postort.toLowerCase();
        return pn.includes(query) || po.includes(query);
      });

      if (matches.length > 0) {
        const kontorLista = [...new Set(matches.map(m => m.kontor))].join(", ");
        document.getElementById('result').textContent = "Kontor: " + kontorLista;
      } else {
        document.getElementById('result').textContent = "Ingen träff hittades.";
      }
    }
  </script>
</body>
</html>
