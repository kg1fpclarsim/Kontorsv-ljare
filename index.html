<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sök kontor</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    :root {
      --bg: #e2e8f0;
      --fg: #2d3748;
      --muted: #a0aec0;
      --brand: #4299e1;
      --brand-dark: #3182ce;
      --card-bg: #ffffff;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--fg);
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center; /* Centrerar vertikalt på stora skärmar */
      justify-content: center;
      padding: 20px;
      transition: background 0.3s ease;
      box-sizing: border-box; /* ÄNDRING: För bättre box-modell */
    }

    .card {
      width: 100%; /* ÄNDRING: Tar upp hela tillgängliga bredden */
      max-width: 560px; /* ÄNDRING: Sätter en max-gräns */
      background: var(--card-bg);
      border-radius: 24px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
      padding: 40px;
      text-align: center;
      border: 1px solid #e2e8f0;
      animation: fadeIn 0.8s ease-in-out;
      box-sizing: border-box; /* ÄNDRING: För bättre box-modell */
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin: 0 0 24px;
      color: #2b6cb0;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
    }

    .row {
      display: flex;
      gap: 16px;
      /* ÄNDRING: Standard är nu 'row' (horisontellt). Detta hanteras för mobil i media queryn nedan. */
      flex-direction: row; 
    }

    input[type="text"] {
      flex: 1; /* Tar upp tillgängligt utrymme */
      min-width: 0; /* Förhindrar overflow i flex-containrar */
      padding: 18px;
      font-size: 16px;
      border: 1px solid #cbd5e0;
      border-radius: 16px;
      outline: none;
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
    }

    input[type="text"]:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 4px rgba(66, 153, 225, 0.3);
    }

    button {
      padding: 18px 28px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 16px;
      background: var(--brand);
      color: #fff;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    button:active {
      background: var(--brand-dark);
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #result {
      margin-top: 28px;
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      word-wrap: break-word;
      color: var(--brand);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
      min-height: 30px;
    }
    
    /* ========================================= */
    /* == NYTT: Media Query för mobila enheter == */
    /* ========================================= */
    @media (max-width: 600px) {
      body {
        /* Flyttar innehållet mot toppen istället för att centrera */
        align-items: flex-start;
        padding-top: 40px; 
      }

      .card {
        padding: 24px; /* Lite mer enhetligt avstånd */
      }

      h1 {
        font-size: 24px; /* Något mindre rubrik på mobil */
      }
      
      .row {
        /* Staplar input och knapp på varandra */
        flex-direction: column; 
      }

      #result {
        font-size: 20px; /* Något mindre resultattext */
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Sök kontor</h1>
    <div class="row">
      <input id="q" type="text" autocomplete="postal-code" placeholder="Postnummer eller ort" />
      <button id="go">Sök</button>
    </div>
    <div id="result"></div>
  </div>

  <script>
    // *** VIKTIGT: Ange din riktiga RAW-länk här ***
    // Exempel: https://raw.githubusercontent.com/<user>/<repo>/<branch>/Schenker%20kontor.csv
    const CSV_URL = "https://raw.githubusercontent.com/kg1fpclarsim/Kontorsv-ljare/refs/heads/main/Schenker%20kontor.csv";

    // --- Hjälpfunktioner ---
    const nz = v => (v == null ? "" : String(v));
    const normHeader = h => nz(h).trim().toLowerCase().replace(/\s+/g, '').replace(/[^a-z0-9åäö]/g, '');
    const normPN = p => nz(p).replace(/\s+/g, '');
    const normTxt = t => nz(t).trim().toLowerCase();

    function bestDelimiter(text) {
      const head = text.slice(0, 5000);
      const counts = { ';': (head.match(/;/g) || []).length, ',': (head.match(/,/g) || []).length, '\t': (head.match(/\t/g) || []).length };
      return Object.entries(counts).sort((a, b) => b[1] - a[1])[0][0];
    }

    function splitCSVLine(line, delim) {
      const out = [];
      let cur = "";
      let q = false;
      const d = delim === "\t" ? "\t" : delim;
      for (let i = 0; i < line.length; i++) {
        const ch = line[i];
        if (ch === '"') {
          if (q && line[i + 1] === '"') {
            cur += '"';
            i++;
          } else {
            q = !q;
          }
        } else if (ch === d && !q) {
          out.push(cur);
          cur = "";
        } else {
          cur += ch;
        }
      }
      out.push(cur);
      return out;
    }

    function parseCSV(text) {
      text = text.replace(/^\uFEFF/, '');
      const delim = bestDelimiter(text);
      const lines = text.split(/\r?\n/).filter(l => l.length > 0);
      if (!lines.length) return { headers: [], rows: [] };
      const headers = splitCSVLine(lines[0], delim).map(h => h.trim());
      const rows = [];
      for (let i = 1; i < lines.length; i++) {
        const cols = splitCSVLine(lines[i], delim);
        const obj = {};
        for (let c = 0; c < headers.length; c++) obj[normHeader(headers[c] || ('col' + c))] = (cols[c] || "").replace(/^"|"$/g, '').trim();
        rows.push(obj);
      }
      return { headers, rows };
    }

    // --- Ladda CSV ---
    let state = { rows: [], headers: [], idx: { postnummer: -1, postort: -1, kontor: -1 } };

    async function init() {
      const resEl = document.getElementById('result');

      if (CSV_URL.includes('DITT_GITHUB_ANVANDARE') || CSV_URL.includes('DITT_REPO')) {
        resEl.textContent = 'Konfigurera CSV_URL i koden med din riktiga raw-länk till "Schenker kontor.csv".';
        return;
      }

      try {
        const resp = await fetch(CSV_URL, { cache: 'no-store' });
        if (!resp.ok) throw new Error(resp.status + ' ' + resp.statusText);
        const text = await resp.text();
        const { headers, rows } = parseCSV(text);
        state.headers = headers;
        state.rows = rows;

        // Mappa kolumner
        const candidates = {
          postnummer: ['Postnummer', 'Postnr', 'Post nr', 'Postkod', 'Postnummer '],
          postort: ['Postort', 'Ort'],
          kontor: ['Kontor', 'Kontorsnamn', 'Kontor namn', 'Kontoret', 'Kontor/Ort', 'Kontorfrk', 'Kontorsförkortning', 'Kontorsforkortning']
        };
        const idx = { postnummer: -1, postort: -1, kontor: -1 };
        const nh = headers.map(normHeader);
        function findIdx(list) {
          for (const wanted of list) {
            const k = normHeader(wanted);
            const i = nh.indexOf(k);
            if (i !== -1) return i;
          }
          return -1;
        }
        idx.postnummer = findIdx(candidates.postnummer);
        idx.postort = findIdx(candidates.postort);
        idx.kontor = findIdx(candidates.kontor);
        state.idx = idx;

        if (rows.length === 0) {
          resEl.textContent = 'CSV laddad men 0 rader hittades.';
        } else if (idx.postnummer === -1 || idx.postort === -1 || idx.kontor === -1) {
          resEl.textContent = 'Kunde inte hitta nödvändiga kolumner (Postnummer, Postort, Kontor). Kontrollera headerrad i CSV.';
        } else {
          resEl.textContent = '';
        }
      } catch (err) {
        document.getElementById('result').textContent = 'Fel vid hämtning av CSV: ' + err.message + '. Om sidan öppnas som en lokal fil kan webbläsaren blockera hämtning – prova att hosta sidan (t.ex. GitHub Pages).';
      }
    }

    // --- Söklogik ---
    function lookup(q) {
      const { rows, idx, headers } = state;
      if (!rows.length) return { text: 'Ingen data laddad', found: false };
      if (idx.postnummer === -1 || idx.postort === -1 || idx.kontor === -1) return { text: 'Saknar nödvändiga kolumner', found: false };

      const pnKey = normPN(q);
      const pnHdr = normHeader(headers[idx.postnummer]);
      const koHdr = normHeader(headers[idx.kontor]);
      for (const r of rows) {
        if (normPN(r[pnHdr]) === pnKey && pnKey) {
          return { text: r[koHdr] || '—', found: true };
        }
      }

      const ortKey = normTxt(q);
      const ortHdr = normHeader(headers[idx.postort]);
      // exakt ort
      for (const r of rows) {
        if (normTxt(r[ortHdr]) === ortKey && ortKey) {
          return { text: r[koHdr] || '—', found: true };
        }
      }
      // snäll fallback: delsträng (minst 2 tecken)
      if (ortKey.length >= 2) {
        for (const r of rows) {
          if (normTxt(r[ortHdr]).includes(ortKey)) {
            return { text: r[koHdr] || '—', found: true };
          }
        }
      }
      return { text: 'Ingen träff', found: false };
    }

    // --- UI ---
    const input = document.getElementById('q');
    const btn = document.getElementById('go');
    const resultEl = document.getElementById('result');

    btn.addEventListener('click', () => {
      const q = input.value.trim();
      if (!q) {
        resultEl.textContent = 'Ange postnummer eller ort';
        return;
      }
      const { text } = lookup(q);
      resultEl.textContent = text;
    });
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') btn.click();
    });

    init();
  </script>
</body>
</html>
